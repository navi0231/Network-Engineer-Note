## 5.5.1 TCP协议
#### TCP传输头
- **源端口**(16位)：源服务访问点
- **目标端口**(16位)：目标服务访问点
- 发送序号(32位)[Sep]：本段第一个数据字节的顺序号
- 接收序号(32位)[Ack]：接收方期望接收的下一个数据字节的顺序号
- 偏置值(4位)：传输头32位字的个数 
> 因为传输头有任选部分，长度不固定，所以需要偏置位
- 标志字段(6位)：表示各种控制信息，其中：
> - URG：紧急指针有效。
> - **ACK**：确认号有效。
> - PSH：尽快交付，不要在缓冲区逗留。
> - RST：连接重置，用于排除故障。
> - **SYN**：建立连接时同步序号。
> - **FIN**：数据发完，释放连接。
- 窗口 (16位)：流控分配的信息量，决定了发送方能发多少数据
- 校验和 (16位)：范围包括首部、数据和伪首部（IP 头的一部分）

#### 三次握手(建立连接)
- A $\to$ B (SYN=1, Seq=X)：客户端请求连接
- B $\to$ A (SYN=1, ACK=1, Seq=Y, Ack=X+1)：服务器端确认并反向请求
- A $\to$ B (ACK=1, Seq=X+1, Ack=Y+1)：客户端最终确认，连接建立

#### 四次握手(关闭连接)
- A $\to$ B (FIN=1, Seq=u): 客户端请求关闭连接
  - 状态变化：A 进入 FIN-WAIT-1
- B $\to$ A (ACK=1, Ack=u+1): 服务器端发送最后数据
  - 状态变化：B 进入 CLOSE-WAIT；A 收到确认后进入 FIN-WAIT-2
- B $\to$ A (FIN=1, ACK=1, Seq=w, Ack=u+1): 服务器发送连接释放报文
  - 状态变化：B 进入 LAST-ACK
- A $\to$ B (ACK=1, Ack=w+1): 客户端发送最终确认报文
  - 状态变化：A 进入 TIME-WAIT。经过 2MSL（最大报文寿命的2倍）时间后，彻底关闭连接

## 5.5.3 UDP协议

|字段名称|位宽 (Bits)|字节长度 (Bytes)|作用描述|
|:---|:---|:---|:---|
|源端口 (Source Port)|16 位|2|发送端进程的标识符（不需要回复時填 0）|
|目的端口 (Dest Port)|16 位|2|接收端进程的标识符（決定数据交给哪个应用）|
|段长 (Length)|16 位|2|UDP 首部 + 数据部分的总长度（最小为 8）|
校验和 (Checksum)|16 位|2|检测传输中是否出错，若出错则丟弃报文|
